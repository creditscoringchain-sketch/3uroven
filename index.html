<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SparkPoint - 3 Levels System</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.8.0/dist/web3.min.js"></script>
    <style>
        /* --- –°–¢–ò–õ–ò (CSS) --- */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background: linear-gradient(135deg, #0f0c29 0%, #302b63 100%); color: #fff; min-height: 100vh; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; }
        
        /* –®–∞–ø–∫–∞ */
        header { text-align: center; margin-bottom: 30px; padding: 20px; background: rgba(255, 255, 255, 0.05); border-radius: 15px; border: 1px solid rgba(255, 255, 255, 0.1); }
        h1 { color: #00d2ff; font-size: 2.2rem; text-shadow: 0 0 15px rgba(0, 210, 255, 0.5); margin-bottom: 5px; }
        .subtitle { color: #8a9ba8; font-size: 1.1rem; }
        
        /* –ö–Ω–æ–ø–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è */
        .connect-box { display: flex; flex-direction: column; align-items: center; gap: 15px; margin-bottom: 30px; }
        .connect-btn { background: linear-gradient(90deg, #00d2ff, #3a7bd5); color: white; border: none; padding: 12px 35px; border-radius: 30px; font-size: 1.1rem; font-weight: bold; cursor: pointer; transition: 0.3s; box-shadow: 0 4px 15px rgba(0, 210, 255, 0.3); }
        .connect-btn:hover { transform: scale(1.05); box-shadow: 0 6px 20px rgba(0, 210, 255, 0.5); }
        .wallet-display { background: rgba(0,0,0,0.3); padding: 10px 20px; border-radius: 8px; font-family: monospace; color: #00d2ff; display: none; border: 1px solid #00d2ff; }

        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: rgba(255, 255, 255, 0.07); padding: 20px; border-radius: 12px; text-align: center; border: 1px solid rgba(255, 255, 255, 0.05); transition: 0.3s; }
        .stat-card:hover { transform: translateY(-5px); background: rgba(255, 255, 255, 0.1); }
        .stat-value { font-size: 1.8rem; font-weight: bold; color: #fff; margin: 10px 0; }
        .stat-label { color: #aab2bd; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px; }

        /* –£—Ä–æ–≤–Ω–∏ –∏ –∫—Ä—É–∂–∫–∏ */
        .levels-section { background: rgba(0, 0, 0, 0.2); padding: 25px; border-radius: 15px; margin-bottom: 30px; border: 1px solid rgba(255, 255, 255, 0.05); }
        .level-row { margin-bottom: 25px; border-bottom: 1px solid rgba(255, 255, 255, 0.05); padding-bottom: 15px; }
        .level-row:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
        
        .level-header { display: flex; justify-content: space-between; margin-bottom: 15px; align-items: center; }
        .level-title { font-size: 1.3rem; font-weight: bold; color: #fff; }
        .level-info { font-size: 0.9rem; color: #00d2ff; }
        
        .circles-wrapper { display: flex; flex-wrap: wrap; gap: 12px; justify-content: flex-start; }
        .circle { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 0.9rem; transition: 0.3s; position: relative; }
        
        /* –°–æ—Å—Ç–æ—è–Ω–∏—è –∫—Ä—É–∂–∫–æ–≤ */
        .circle.empty { background: rgba(255, 255, 255, 0.05); border: 2px dashed rgba(255, 255, 255, 0.2); color: rgba(255, 255, 255, 0.3); }
        .circle.filled { background: linear-gradient(135deg, #00d2ff, #3a7bd5); border: 2px solid #fff; color: #000; box-shadow: 0 0 10px rgba(0, 210, 255, 0.5); transform: scale(1.1); z-index: 2; }
        .circle.locked { background: #1a1a1a; border: 2px solid #333; opacity: 0.5; color: #555; cursor: not-allowed; }

        /* –ü–∞–Ω–µ–ª—å –¥–µ–π—Å—Ç–≤–∏–π */
        .action-panel { display: grid; grid-template-columns: 1fr; gap: 20px; }
        @media (min-width: 768px) { .action-panel { grid-template-columns: 1fr 1fr; } }
        
        .panel-box { background: rgba(255, 255, 255, 0.05); padding: 20px; border-radius: 12px; border: 1px solid rgba(255, 255, 255, 0.1); }
        .panel-title { color: #00d2ff; margin-bottom: 15px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); padding-bottom: 5px; font-size: 1.1rem; }
        
        input[type="text"] { width: 100%; padding: 12px; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; color: white; margin-bottom: 10px; outline: none; transition: 0.3s; }
        input[type="text"]:focus { border-color: #00d2ff; }
        
        .btn-action { width: 100%; padding: 12px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; color: #fff; transition: 0.3s; margin-top: 5px; }
        .btn-green { background: linear-gradient(90deg, #00b09b, #96c93d); box-shadow: 0 4px 10px rgba(150, 201, 61, 0.3); }
        .btn-green:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(150, 201, 61, 0.5); }
        .btn-copy { background: #3a7bd5; }
        .btn-copy:hover { background: #2c6cb5; }

        /* –ê–¥–º–∏–Ω–∫–∞ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .admin-badge { background: #ffd700; color: #000; padding: 3px 8px; border-radius: 5px; font-size: 0.8rem; font-weight: bold; vertical-align: middle; display: none; margin-left: 10px; }
        .admin-controls { margin-top: 30px; border-top: 2px dashed #444; padding-top: 20px; display: none; }

        .loader { border: 3px solid rgba(255,255,255,0.1); border-top: 3px solid #fff; border-radius: 50%; width: 18px; height: 18px; animation: spin 1s linear infinite; display: inline-block; vertical-align: middle; margin-left: 10px; display: none; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .status-msg { margin-top: 10px; padding: 12px; border-radius: 8px; font-size: 0.9rem; display: none; text-align: center; }
        .status-error { background: rgba(255, 65, 108, 0.2); border: 1px solid rgba(255, 65, 108, 0.3); color: #ff6b6b; }
        .status-success { background: rgba(0, 176, 155, 0.2); border: 1px solid rgba(0, 176, 155, 0.3); color: #00b09b; }

        footer { text-align: center; margin-top: 40px; color: #555; font-size: 0.8rem; }
        a { color: #00d2ff; text-decoration: none; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>SparkPoint <span id="adminBadge" class="admin-badge">ADMIN</span></h1>
        <div class="subtitle">–°–∏—Å—Ç–µ–º–∞ 3-—Ö —É—Ä–æ–≤–Ω–µ–π —Å –∞–≤—Ç–æ-–∞–ø–≥—Ä–µ–π–¥–æ–º</div>
    </header>

    <div class="connect-box">
        <button id="connectBtn" class="connect-btn" onclick="connectWallet()">–ü–æ–¥–∫–ª—é—á–∏—Ç—å –∫–æ—à–µ–ª–µ–∫ (MetaMask)</button>
        <div id="walletDisplay" class="wallet-display">Not Connected</div>
    </div>

    <div id="dashboard" style="display: none;">
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="currentLevel">0</div>
                <div class="stat-label">–í–∞—à –£—Ä–æ–≤–µ–Ω—å</div>
            </div>
            <div class="stat-card">
                <div class="stat-value"><span id="personalRefs">0</span> / 2</div>
                <div class="stat-label">–õ–∏—á–Ω—ã–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="internalBal">0 BNB</div>
                <div class="stat-label">–ù–∞–∫–æ–ø–ª–µ–Ω–∏—è (99%)</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="uplineAddr">...</div>
                <div class="stat-label">–í–∞—à –ö—É—Ä–∞—Ç–æ—Ä</div>
            </div>
        </div>

        <div class="levels-section">
            <h2 style="margin-bottom: 20px; color: #fff; font-size: 1.5rem;">–í–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å</h2>
            <div id="levelsContainer">
                </div>
        </div>

        <div class="action-panel">
            
            <div class="panel-box" id="refLinkPanel" style="display:none;">
                <h3 class="panel-title">–í–∞—à–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞</h3>
                <p style="font-size: 0.85rem; color: #aaa; margin-bottom: 10px;">–û—Ç–ø—Ä–∞–≤—å—Ç–µ —ç—Ç—É —Å—Å—ã–ª–∫—É –ø–∞—Ä—Ç–Ω–µ—Ä–∞–º. –ú–∞–∫—Å–∏–º—É–º 2 —á–µ–ª–æ–≤–µ–∫–∞.</p>
                <input type="text" id="refLinkInput" readonly value="–ó–∞–≥—Ä—É–∑–∫–∞...">
                <button class="btn-action btn-copy" onclick="copyRefLink()">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</button>
                <div id="refWarning" style="color: #ff6b6b; font-size: 0.9rem; margin-top: 10px; font-weight:bold; display:none; border: 1px solid #ff6b6b; padding: 8px; border-radius: 5px;">
                    ‚ö†Ô∏è –°—Å—ã–ª–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞: –õ–∏–º–∏—Ç (2/2) –¥–æ—Å—Ç–∏–≥–Ω—É—Ç.
                </div>
            </div>

            <div class="panel-box" id="regPanel" style="display:none;">
                <h3 class="panel-title">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ –ø—Ä–æ–µ–∫—Ç–µ</h3>
                <label style="font-size:0.9rem; color:#aaa; display:block; margin-bottom:5px;">–ê–¥—Ä–µ—Å –ø—Ä–∏–≥–ª–∞—Å–∏—Ç–µ–ª—è:</label>
                <input type="text" id="refInput" placeholder="0x...">
                <div style="margin-bottom: 10px; font-size: 0.85rem; color: #00d2ff;">–°—Ç–æ–∏–º–æ—Å—Ç—å –≤—Ö–æ–¥–∞: 0.01 BNB</div>
                <button class="btn-action btn-green" onclick="register()">
                    –û–ø–ª–∞—Ç–∏—Ç—å 0.01 BNB <div id="regLoader" class="loader"></div>
                </button>
                <div id="regMsg" class="status-msg"></div>
            </div>
            
            <div class="panel-box">
                <h3 class="panel-title">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                <ul style="list-style: none; font-size: 0.9rem; color: #ccc; line-height: 1.6;">
                    <li>üîπ <b>–£—Ä–æ–≤–µ–Ω—å 1:</b> –ù—É–∂–Ω–æ 2 —á–µ–ª–æ–≤–µ–∫–∞. –í—ã–ø–ª–∞—Ç—ã –∫–æ–ø—è—Ç—Å—è.</li>
                    <li>üîπ <b>–£—Ä–æ–≤–µ–Ω—å 2:</b> –ù—É–∂–Ω–æ 6 —á–µ–ª–æ–≤–µ–∫. –í—ã–ø–ª–∞—Ç—ã –∫–æ–ø—è—Ç—Å—è.</li>
                    <li>üîπ <b>–£—Ä–æ–≤–µ–Ω—å 3:</b> –ù—É–∂–Ω–æ 14 —á–µ–ª–æ–≤–µ–∫. –í—ã–ø–ª–∞—Ç—ã –Ω–∞ –∫–æ—à–µ–ª–µ–∫!</li>
                    <li>‚õî –ù–µ–ª—å–∑—è –ø—Ä–∏–≥–ª–∞—Å–∏—Ç—å 2-–≥–æ, –ø–æ–∫–∞ –≤–∞—à –∫—É—Ä–∞—Ç–æ—Ä –Ω–µ –ø—Ä–∏–≥–ª–∞—Å–∏–ª –¥–≤–æ–∏—Ö.</li>
                </ul>
            </div>
        </div>
    </div>

    <div id="adminPanel" class="admin-controls">
        <h2 style="color: #ffd700; margin-bottom: 15px;">üëë –ü–∞–Ω–µ–ª—å –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h2>
        <div class="panel-box" style="border: 1px solid #ffd700;">
            
            <h3 class="panel-title" style="color: #ffd700;">–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–∞</h3>
            <div style="display: grid; gap: 10px; grid-template-columns: 1fr 1fr;">
                <input type="text" id="adminNewUser" placeholder="–ê–¥—Ä–µ—Å –Ω–æ–≤–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞">
                <input type="text" id="adminNewRef" placeholder="–ê–¥—Ä–µ—Å –µ–≥–æ –ø—Ä–∏–≥–ª–∞—Å–∏—Ç–µ–ª—è">
            </div>
            <button class="btn-action" style="background: #ffd700; color: #000; font-weight:800;" onclick="adminAddUser()">
                –î–æ–±–∞–≤–∏—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ <div id="adminLoader" class="loader" style="border-top-color: #000;"></div>
            </button>
            <div id="adminMsg" class="status-msg"></div>
            
            <hr style="margin: 20px 0; border-color: #444;">
            
            <h3 class="panel-title" style="color: #ffd700;">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Å—Å–æ–π</h3>
            <button class="btn-action" style="background: #333; border: 1px solid #ffd700; color: #ffd700;" onclick="adminWithdraw()">
                –í—ã–≤–µ—Å—Ç–∏ –≤—Å–µ —Å—Ä–µ–¥—Å—Ç–≤–∞ —Å –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞
            </button>
        </div>
    </div>
    
    <footer>
        Contract: <a href="https://testnet.bscscan.com/address/0x2c52760504AF1a405A225631947a8BF604fA74b9" target="_blank">0x2c52...74b9</a>
    </footer>

</div>

<script>
    // ==========================================
    // 1. –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø
    // ==========================================
    const CONTRACT_ADDRESS = "0x2c52760504AF1a405A225631947a8BF604fA74b9"; // –¢–í–û–ô –ù–û–í–´–ô –ê–î–†–ï–°
    
    // ABI (–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞)
    const CONTRACT_ABI = [
        {"inputs":[],"stateMutability":"nonpayable","type":"constructor"},
        {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"InternalCredit","type":"event"},
        {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"level","type":"uint256"}],"name":"LevelUp","type":"event"},
        {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"level","type":"uint256"}],"name":"Payout","type":"event"},
        {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":true,"internalType":"address","name":"referrer","type":"address"}],"name":"Registered","type":"event"},
        {"inputs":[],"name":"ENTRY_PRICE","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
        {"inputs":[],"name":"admin","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},
        {"inputs":[{"internalType":"address","name":"_user","type":"address"},{"internalType":"address","name":"_referrer","type":"address"}],"name":"adminAddUser","outputs":[],"stateMutability":"nonpayable","type":"function"},
        {"inputs":[{"internalType":"address","name":"_user","type":"address"}],"name":"getUserStatus","outputs":[{"internalType":"uint256","name":"currentLevel","type":"uint256"},{"internalType":"address","name":"hisReferrer","type":"address"},{"internalType":"uint256","name":"filledInCurrentLevel","type":"uint256"},{"internalType":"uint256","name":"neededForNextLevel","type":"uint256"},{"internalType":"uint256","name":"totalPersonalReferrals","type":"uint256"},{"internalType":"uint256","name":"balance","type":"uint256"},{"internalType":"bool","name":"isRegistered","type":"bool"}],"stateMutability":"view","type":"function"},
        {"inputs":[{"internalType":"address","name":"_referrer","type":"address"}],"name":"register","outputs":[],"stateMutability":"payable","type":"function"},
        {"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"thresholds","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
        {"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"users","outputs":[{"internalType":"uint256","name":"level","type":"uint256"},{"internalType":"address","name":"referrer","type":"address"},{"internalType":"uint256","name":"referralsInLevel","type":"uint256"},{"internalType":"uint256","name":"totalDirectReferrals","type":"uint256"},{"internalType":"uint256","name":"internalBalance","type":"uint256"},{"internalType":"bool","name":"exists","type":"bool"}],"stateMutability":"view","type":"function"},
        {"inputs":[],"name":"withdraw","outputs":[],"stateMutability":"nonpayable","type":"function"}
    ];

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫—Ä—É–∂–∫–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—Ä–æ–≤–Ω—è
    const LEVELS_CONFIG = [
        { level: 1, slots: 2 },
        { level: 2, slots: 6 },
        { level: 3, slots: 14 }
    ];

    let web3;
    let contract;
    let userAccount;

    // ==========================================
    // 2. –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø WEB3
    // ==========================================
    async function initWeb3() {
        if (window.ethereum) {
            web3 = new Web3(window.ethereum);
            try {
                // –ó–∞–ø—Ä–æ—Å –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–∫–∫–∞—É–Ω—Ç—É
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                userAccount = accounts[0];
                
                // –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞
                contract = new web3.eth.Contract(CONTRACT_ABI, CONTRACT_ADDRESS);
                
                updateUIConnected();
                await loadUserData();
                await checkAdmin();
                
                // –ï—Å–ª–∏ —Å–º–µ–Ω–∏–ª–∏ –∞–∫–∫–∞—É–Ω—Ç –≤ –º–µ—Ç–∞–º–∞—Å–∫–µ - –ø–µ—Ä–µ–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
                window.ethereum.on('accountsChanged', function (accounts) {
                    window.location.reload();
                });

            } catch (error) {
                console.error("User denied account access", error);
            }
        } else {
            alert('–î–ª—è —Ä–∞–±–æ—Ç—ã –Ω—É–∂–µ–Ω MetaMask! –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ.');
        }
    }

    function updateUIConnected() {
        document.getElementById('connectBtn').style.display = 'none';
        const display = document.getElementById('walletDisplay');
        display.style.display = 'block';
        display.innerText = userAccount.substring(0,6) + "..." + userAccount.substring(38);
        document.getElementById('dashboard').style.display = 'block';
    }

    function connectWallet() {
        initWeb3();
    }

    // ==========================================
    // 3. –ó–ê–ì–†–£–ó–ö–ê –î–ê–ù–ù–´–•
    // ==========================================
    async function loadUserData() {
        try {
            // –í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ getUserStatus –∏–∑ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞
            const data = await contract.methods.getUserStatus(userAccount).call();
            
            const currentLevel = parseInt(data.currentLevel);
            const filled = parseInt(data.filledInCurrentLevel);
            const directRefs = parseInt(data.totalPersonalReferrals);
            const balanceWei = data.balance;
            const isReg = data.isRegistered;
            const referrer = data.hisReferrer;

            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            document.getElementById('currentLevel').innerText = currentLevel;
            document.getElementById('personalRefs').innerText = directRefs;
            document.getElementById('internalBal').innerText = web3.utils.fromWei(balanceWei, 'ether') + ' BNB';
            
            // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫—É—Ä–∞—Ç–æ—Ä–∞
            if (referrer === '0x0000000000000000000000000000000000000000') {
                document.getElementById('uplineAddr').innerText = "–ù–µ—Ç (–ê–¥–º–∏–Ω)";
            } else {
                document.getElementById('uplineAddr').innerText = referrer.substring(0,6) + "..." + referrer.substring(38);
            }

            // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–Ω–µ–ª—è–º–∏ (–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è vs –†–µ—Ñ —Å—Å—ã–ª–∫–∞)
            if (isReg) {
                document.getElementById('regPanel').style.display = 'none';
                document.getElementById('refLinkPanel').style.display = 'block';
                
                // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Å—ã–ª–∫–∏
                const origin = window.location.origin + window.location.pathname;
                document.getElementById('refLinkInput').value = `${origin}?ref=${userAccount}`;

                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ (–µ—Å–ª–∏ 2 –ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω—ã—Ö - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ)
                if(directRefs >= 2) {
                     document.getElementById('refWarning').style.display = 'block';
                }
            } else {
                document.getElementById('regPanel').style.display = 'block';
                document.getElementById('refLinkPanel').style.display = 'none';
                checkUrlRef(); // –ü—Ä–æ–≤–µ—Ä—è–µ–º URL –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Ä–µ—Ñ–∫–∏
            }

            // –†–∏—Å—É–µ–º –∫—Ä—É–∂–∫–∏
            renderLevels(currentLevel, filled);

        } catch (e) {
            console.error("Error loading data:", e);
        }
    }

    function renderLevels(userLevel, filledCount) {
        const container = document.getElementById('levelsContainer');
        container.innerHTML = ''; // –û—á–∏—â–∞–µ–º

        LEVELS_CONFIG.forEach(cfg => {
            const isCurrent = (cfg.level === userLevel);
            const isPassed = (userLevel > cfg.level); // –£—Ä–æ–≤–µ–Ω—å –ø—Ä–æ–π–¥–µ–Ω
            const isLocked = (userLevel < cfg.level); // –£—Ä–æ–≤–µ–Ω—å –∑–∞–∫—Ä—ã—Ç
            
            let statusText = '';
            if (isPassed) statusText = '<span style="color:#00b09b">‚úÖ –ü—Ä–æ–π–¥–µ–Ω</span>';
            else if (isLocked) statusText = '<span style="color:#555">üîí –ó–∞–∫—Ä—ã—Ç</span>';
            else statusText = `<span style="
